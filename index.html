<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>부천시 직업훈련기관 지도</title>
    <style>
        #map { width: 100%; height: 700px; }
        .category-filter {
            margin: 10px 0;
            padding: 10px;
            background: #f8f8f8;
            border-radius: 5px;
        }
        .category-filter label {
            margin-right: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>부천시 직업훈련기관 지도</h1>
   
    <!-- 직종별 필터 -->
    <div class="category-filter">
        <label><input type="checkbox" value="IT" checked> IT</label>
        <label><input type="checkbox" value="건축시공" checked> 건축시공</label>
        <label><input type="checkbox" value="요양" checked> 요양</label>
        <label><input type="checkbox" value="간호조무" checked> 간호조무</label>
        <label><input type="checkbox" value="아이돌봄" checked> 아이돌봄</label>
        <label><input type="checkbox" value="기계제어" checked> 기계제어</label>
        <label><input type="checkbox" value="조리" checked> 조리</label>
        <label><input type="checkbox" value="미용" checked> 미용</label>
        <label><input type="checkbox" value="애견미용" checked> 애견미용</label>
    </div>
    <div id="map"></div>

    <!-- 카카오맵 API 불러오기 (autoload=false 옵션 추가) -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=6aca95ac3e00dd47c115ad401ec52665&autoload=false"></script>
    <script>
        kakao.maps.load(function() {
            var mapContainer = document.getElementById('map');
            var mapOption = {
                center: new kakao.maps.LatLng(37.4981, 126.7666), // 부천시 중심 좌표
                level: 6
            };
            var map = new kakao.maps.Map(mapContainer, mapOption);  
            var markers = [];
            var bounds = new kakao.maps.LatLngBounds(); // 지도 범위 객체 추가
           
            // 현재 열려있는 인포윈도우 추적 변수 추가
            var openInfowindow = null;
               
            // 지도 확대/축소 이벤트 리스너 추가
            kakao.maps.event.addListener(map, 'zoom_changed', function() {
                updateMarkerSizes();
            });
           
            // 마커 크기 업데이트 함수
            function updateMarkerSizes() {
                var currentLevel = map.getLevel();
                var newWidth, newHeight;
               
                if (currentLevel <= 3) {
                    newWidth = 100;
                    newHeight = 100;
                } else if (currentLevel <= 6) {
                    newWidth = 80;
                    newHeight = 80;
                } else {
                    newWidth = 60;
                    newHeight = 60;
                }
               
                markers.forEach(function(marker) {
                    var category = marker.getTitle().split(':')[0]; // 마커에 저장한 카테고리 정보
                    var imageSrc = getMarkerImageSrc(category);
                    var newImageSize = new kakao.maps.Size(newWidth, newHeight);
                    var markerImage = new kakao.maps.MarkerImage(imageSrc, newImageSize);
                    marker.setImage(markerImage);
                });
            }
           
            // 직종별 이미지 경로 반환 함수
            function getMarkerImageSrc(category) {
                if (category === 'IT') { return 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_blue.png'; }
                else if (category === '건축시공') { return 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_brown.png'; }
                else if (category === '요양') { return 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_gray.png'; }
                else if (category === '간호조무') { return 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_skyblue.png'; }
                else if (category === '아이돌봄') { return 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_yellow.png'; }
                else if (category === '기계제어') { return 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_green.png'; }
                else if (category === '조리') { return 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_orange.png'; }
                else if (category === '미용') { return 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_purple.png'; }
                else if (category === '애견미용') { return 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_pink.png'; }
                else { return 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_red.png'; }
            }
           
            fetch('훈련기관데이터_v1.json')
                .then(response => response.json())
                .then(data => {
                    console.log('데이터 로드 성공:', data);
                   
                    var checkboxes = document.querySelectorAll('input[type=checkbox]');
                    var selectedCategories = [];
                    checkboxes.forEach(function(cb) {
                        if (cb.checked) selectedCategories.push(cb.value);
                    });
                    createMarkers(data, selectedCategories);
                   
                    checkboxes.forEach(function(checkbox) {
                        checkbox.addEventListener('change', function() {
                            var selected = [];
                            checkboxes.forEach(function(cb) {
                                if (cb.checked) selected.push(cb.value);
                            });
                            createMarkers(data, selected);
                        });
                    });
                })
                .catch(error => console.error('데이터 로드 실패:', error));
           
            function createMarkers(centers, categoryFilter) {
                markers.forEach(function(marker) {
                    marker.setMap(null);
                });
                markers = [];
                bounds = new kakao.maps.LatLngBounds();
                centers.forEach(function(center) {
                    var centerCategory = center.직종 || center.category;
                   
                    if (categoryFilter.includes(centerCategory)) {
                        var markerPosition = new kakao.maps.LatLng(
                            parseFloat(center.위도 || center.lat),
                            parseFloat(center.경도 || center.lng)
                        );
                        bounds.extend(markerPosition);
                        // 마커 이미지 경로 및 크기 지정
                        var imageSrc = '';  // 마커 이미지 URL (직종별로 다르게 설정)
                        if (centerCategory === 'IT') {imageSrc = 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_blue.png';}
                        else if (centerCategory === '건축시공') {imageSrc = 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_brown.png';}
                        else if (centerCategory === '요양') {imageSrc = 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_gray.png';}
                        else if (centerCategory === '간호조무') {imageSrc = 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_skyblue.png';}
                        else if (centerCategory === '아이돌봄') {imageSrc = 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_yellow.png';}
                        else if (centerCategory === '기계제어') {imageSrc = 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_green.png';}
                        else if (centerCategory === '조리') {imageSrc = 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_orange.png';}
                        else if (centerCategory === '미용') {imageSrc = 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_purple.png';}
                        else if (centerCategory === '애견미용') {imageSrc = 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_pink.png';}
                        else {imageSrc = 'https://raw.githubusercontent.com/whj80/whj80.github.io/main/marker_red.png';}

                        var imageSize = new kakao.maps.Size(100, 100);  // 마커 크기 조절 (크게)
                        var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);
                       
                        // 마커 생성
                        var marker = new kakao.maps.Marker({
                            map: map,
                            position: markerPosition,
                            title: centerCategory + ': ' + (center.훈련기관명 || center.name),
                            image: markerImage
                        });
                           
                        var content = '<div style="padding:5px;width:200px;">' +
                            '<strong>' + (center.훈련기관명 || center.name) + '</strong><br>' +
                            '직종: ' + centerCategory + '<br>' +
                            '주소: ' + (center.주소 || center.address) + '<br>' +
                            '연락처: ' + (center.연락처 || center.contact) + '<br>'
                            '홈페이지: ' + (center.홈페이지 || center.website) + '<br>';
                       
                        if (center.홈페이지 || center.website) {
                            content += '<a href="' + (center.홈페이지 || center.website) +
                                '" target="_blank">웹사이트 방문</a>';
                        }
                       
                        content += '</div>';
                       
                        var infowindow = new kakao.maps.InfoWindow({
                            content: content
                        });
                         // 토글 기능 적용한 마커 클릭 이벤트
                        kakao.maps.event.addListener(marker, 'click', function() {
                            if (openInfowindow === infowindow) {
                                infowindow.close();
                                openInfowindow = null;
                            } else {
                                if (openInfowindow) {
                                    openInfowindow.close();
                                }
                                infowindow.open(map, marker);
                                openInfowindow = infowindow;
                            }
                        })
                       
                        markers.push(marker);
                    }
                });
                if (markers.length > 0) {
                    map.setBounds(bounds);
                }
            }
        });
    </script>
</body>
</html>
